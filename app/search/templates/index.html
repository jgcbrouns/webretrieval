<!DOCTYPE HTML>
<!-------------------------------------------/*
   *  Fancy Input
   *
   *  Copyright 2013, Yair Even Or
   *  https://dropthebit.com
   *
   *  Licensed under the MIT license:
   *  http://www.opensource.org/licenses/MIT
   */------------------------------------------>
<html lang="en">
   <head>
      <!--[if IE]>
      <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
      <![endif]-->
      <meta charset="utf-8">
      <title>Web Retrieval Project Website</title>
      <meta name="description" content="Makes HTML input field typing fun with some CSS3 effects">
      <meta name="viewport" content="width=device-width">
      <link rel="shortcut icon" href="favicon.ico">
      {% load staticfiles %}
      <link rel="stylesheet" href="{% static 'search/css/styles.css' %}">
      <link rel="stylesheet" href="{% static 'search/css/fancyInput.css' %}">
      <link rel="stylesheet" href="{% static 'search/css/bootstrap.css' %}">
      <link rel="stylesheet" href="{% static 'search/css/spinner.css' %}">
      <link rel="stylesheet" href="{% static 'search/css/main.css' %}">
      <link rel="stylesheet" href="{% static 'search/css/fancyInput.css' %}">
      <!--[if lt IE 9]><script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
      <script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
   </head>
   <body>
      <!-- 	<form method="get" action="/"> -->
      <div class="inputContainer">
         <section class='input'>
            <div>
               <input type='text' autocomplete="off" placeholder='' name="q" id="id_q" value="{{ query }}">
            </div>
         </section>
         <!-- 	<input type="submit" id="submitButton" value="Search"/> -->
      </div>
      <!-- 	</form> -->
      
      <div class="tableContainer">
         <div class="loader">
            <h1>LOADING</h1>
            <span></span>
            <span></span>
            <span></span>
         </div>

         <!-- Div for display errors -->
         <div id="results"></div>

         {% if papers %}
         <section id="tablePart">
            <h1>Results:</h1>
            <div class="tbl-header">
               <table cellpadding="0" cellspacing="0" border="0">
                  <thead>
                     <tr>
                        <th>Papers</th>
                        <th>Year</th>
                        <th>Authors</th>
                     </tr>
                  </thead>
               </table>
            </div>
            <div class="tbl-content">
               <table cellpadding="0" cellspacing="0" border="0">
                  <tbody>
                     {% for paper in papers %}
                     <tr>
                        <td>{{ paper.title }}</td>
                        <td>{{ paper.year }}</td>
                        <td>/</td>
                     </tr>
                     {% endfor %}
                  </tbody>
               </table>
            </div>
         </section>
         {% endif %}
      </div>
      <!--  -->
      <a class='git' title='TUE' href='https://tue.nl'><img width="150px" src="{% static 'search/images/tuelogo.png' %}"></a>
      <script src='{% static 'search/css/fancyInput.js' %}'></script>
      <script>
         $('section :input').val('').fancyInput()[0].focus();
         
         //For the table
         $(window).on("load resize ", function() {
           var scrollWidth = $('.tbl-content').width() - $('.tbl-content table').width();
           $('.tbl-header').css({'padding-right':scrollWidth});
         }).resize();
         
         loadingOff();
         
         $( "#submitButton" ).click(function() {
           	$('#tablePart').hide();
           	$('.loader').show();
         
         });
         
         function loadingOn()
         {
           	$('#tablePart').hide();
           	$('.loader').show();
         }
         
         function loadingOff()
         {
         	$('#tablePart').show();
           	$('.loader').hide();	
         }
         
         $("#id_q").on('input', function() {
         	loadingOn();
           	event.preventDefault();
           	console.log("form submitted!");
           	create_post();
         });
         
		// AJAX for posting
		function create_post() {
		    console.log("create post is working!") // sanity check
		    $.ajax({
		        url : "/", // the endpoint
		        type : "POST", // http method
		        data : { the_post : $('#id_q').val() }, // data sent with the post request

		        // handle a successful response
		        success : function(json) {
		            //$('#post-text').val(''); // remove the value from the input
		            console.log(json); // log the returned json to the console
		            console.log("success"); // another sanity check
		        },

		        // handle a non-successful response
		        error : function(xhr,errmsg,err) {
		            $('#results').html("<div class='alert-box alert radius' style='margin-top:20px; color: #FFF' data-alert>Oops! We have encountered an error: "+errmsg+
		                " <a href='#' class='close'>&times;</a></div>"); // add the error to the dom
		            console.log(xhr.status + ": " + xhr.responseText); // provide a bit more info about the error to the console
		        }
		    });
		};
         
      </script>
   </body>
</html>